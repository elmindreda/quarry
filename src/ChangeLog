2004-08-12  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-preferences.c (gtk_gtp_engine_dialog_present):
	Properly handle requests for modification of engine
	information (don't die with assertion failure).
	(gtk_gtp_engine_dialog_response, client_deleted): Handle "modify
	engine information" version of dialog.
	(update_engine_screen_name)
	(find_gtp_tree_model_iterator_by_engines_data): New
	functions (break out of chain_client_initialized()).

	* gui-gtk/quarry-stock.c: New stock item `QUARRY_STOCK_MODIFY'.

	* gui-gtk/gtk-preferences.c (create_background_table): Add button
	for browsing for a texture.
	(browse_for_gtp_engine, browsing_dialog_response): Remove
	functions.

	* gui-gtk/gtk-utils.c (gtk_utils_create_browse_button)
	(browse_button_clicked, browsing_dialog_response): New
	functions (mostly inherit code of removed functions in
	`gtk-preferences.c').

	* gui-gtk/gtk-preferences.c (gtk_preferences_dialog_present):
	Adapt page selection to new (tree) categories model.  Don't crash
	when invoked with preferences dialog already shown and
	`page_to_select' equal to -1.

2004-08-11  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-preferences.c: Split "Board Appearance" category
	into three (one per game).
	(gtk_preferences_dialog_present): Arrange preferences categories
	in a tree rather than in a list.
	(create_board_appearance_page): Remove function.
	(create_go_board_appearance_page)
	(create_amazons_board_appearance_page)
	(create_othello_board_appearance_page)
	(create_board_appearance_widgets)
	(create_board_appearance_notebook_page): New
	functions (essentially, inherit the code of removed
	create_board_appearance_page()).
	(gtk_preferences_dialog_change_page): Take care not to switch to
	nonexistent pages.

2004-08-10  Paul Pogonyshev  <pogonyshev@gmx.net>

	* board/go.c (go_mark_territory_on_grid): Detect false eyes that
	don't yield territory and don't mark them.

2004-08-09  Paul Pogonyshev  <pogonyshev@gmx.net>

	* Makefile.am (quarry_LDADD): Include `QUARRY_GTHREAD_LIBS' (split
	off from `QUARRY_GTK_LIBS') and new `QUARRY_RSVG_LIBS' flags.
	* gui-gtk/Makefile.am (QUARRY_FULL_GTK_CFLAGS): Include
	`QUARRY_GTHREAD_CFLAGS' (split off from `QUARRY_GTK_CFLAGS') and
	new `QUARRY_RSVG_CFLAGS'.

2004-08-07  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-preferences.c (create_gtp_engines_page): Create GTP
	engine information labels.
	(gtk_preferences_dialog_update_gtp_engine_info): Display selected
	GTP engine name, version, command line and supported games in
	corresponding labels.

	* gui-gtk/gtk-utils.c (gtk_utils_create_left_aligned_label): New
	function.

	* utils/string-list.c (string_list_implode): New function.

	* gui-gtk/gtk-goban.c (gtk_goban_expose): Draw a small rectangle
	to indicate focused state of widget.
	(gtk_goban_button_press_event): Grab focus when goban is clicked
	outside the playing area (e.g. on labels).
	(gtk_goban_focus_in_or_out_event): New function.

2004-08-04  Paul Pogonyshev  <pogonyshev@gmx.net>

	* quarry.c (main): Use `SIG_IGN' as signal handler for `SIGPIPE'.
	(catch_broken_pipe_signal): Remove function.

2004-07-22  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c (gtk_goban_window_save): Handle
	"Save" command, but issue warning about potential loss of
	information (bug #522).

2004-07-20  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c: Make it safe to navigate to a
	different node while a game (with GTP engines participating) is
	going on.
	(IS_DISPLAYING_GAME_NODE): New macro.
	(navigate_goban): Handle special cases of navigating from/to the
	current game node.
	(move_has_been_generated): Take care to attach new moves to the
	current game's node, not to the displayed node.

	* board/board.c (board_duplicate_without_stacks): New function.

2004-07-16  Paul Pogonyshev  <pogonyshev@gmx.net>

	* sgf/sgf-tree.c (sgf_game_tree_set_state): New function.

	* gui-utils/parse-configuration.c (configuration_parse_defaults2):
	Initialize a few variables to avoid compiler warnings.
	* gui-gtk/gtk-new-game-dialog.c (gtk_new_game_dialog_present):
	Likewise.
	(begin_game): Likewise.

2004-07-16  Martin Holters  <martin.holters@gmx.de>

	* board/go.c (go_score_game): Don't use utils_format_double(),
	format as user's locale specifies.
	* gui-gtk/gtk-goban-window.c (update_game_specific_information):
	Likewise.

	* sgf/sgf-tree.c (sgf_node_get_komi): Use utils_parse_double().
	* gui-utils/configuration.c (configuration_read_from_file):
	Likewise for parsing values of type `VALUE_TYPE_REAL'.

	* utils/utils.c (utils_format_double): Don't use sprintf() and
	thus be locale insensitive.
	(utils_parse_double): New function, parse doubles in
	locale-insensitive manner.

2004-06-19  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-utils.c (time_spin_button_input): Use new function
	utils_parse_time() (which contains the code previously resided
	here).

	* gui-gtk/gtk-utils.h (gtk_utils_set_selector_active_item_index):
	New macro.

	* gui-gtk/gtk-new-game-dialog.c (gtk_new_game_dialog_present):
	Initialize time control parameter widgets from configuration
	variables.
	(begin_game): Store time control configuration at successful game
	start.

	* gui-gtk/gtk-configuration-structures.c: Remove file.
	* gui-gtk/gtk-configuration-structures.h: Remove file.

	* gui-gtk/gtk-configuration.list: Ask `parse-configuration' to
	declare `NewGameConfiguration' structure.  Break game-specific
	variables out to separate sections.  Add time control variables
	for each game.

	* gui-utils/common-configuration-defaults.list: Update for new
	format of fields of structural types.

	* gui-utils/parse-configuration.c: Rewrite to allow random
	structure declarations and array fields.  Add support for
	configuration variables of `time' type.
	(push_subscription_stack, pop_subscription_stack)
	(recursively_build_full_field_name)
	(add_field_declaration_if_needed)
	(add_field_dispose_call_if_needed)
	(recursively_build_full_field_name): New functions.

	* gui-utils/configuration.c (configuration_read_from_file)
	(write_section): Add support for `time' configuration value type.
	(write_section): Change indentation of variable value from 16 to
	24 (variable names are usually long).

	* utils/parse-list.c (parse_thing): Allow `FIELD_NAME' to have '['
	as its first character.  Handle new thing type, `TIME_VALUE'.

	* utils/utils.c (utils_cat_string): Allow `string' argument to be
	NULL.
	(utils_cat_as_string): Likewise.
	(utils_format_double): Rename from format_double() and move here.
	(utils_parse_time): Break out from time_spin_button_input() (a
	function in `gui-gtk/gtk-utils.c').

	* utils/format.c: Remove file.

2004-06-18  Paul Pogonyshev  <pogonyshev@gmx.net>

	* sgf/sgf-parser.c (parse_property): Bug-fix: store return value
	of utils_cat_as_string() back in `(*link)->value.text'.

2004-06-12  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c (gtk_goban_window_init): Create
	labels for displaying game-specific information (number of
	captures and komi for Go, number of disks for Othello).
	(set_current_tree): Hide the labels for Amazons (not used).
	(update_game_specific_information): New function, fill the labels
	with information.

	* gui-gtk/gtk-utils.c (gtk_utils_set_widgets_visible): New
	function.

	* board/othello.c (othello_count_disks): New function.

	* gui-utils/tile-set.c (create_go_stone_images): Create 50%
	transparent tile of mixed colors (half black, half white).
	* gui-gtk/gtk-goban-window.c (update_children_for_new_node): Mark
	positions with variations of both color with new tile.

	* gui-gtk/gtk-goban-window.c (gtk_goban_window_init): Create clock
	widgets for both players.
	(gtk_goban_window_enter_game_mode): Take care of time control.
	(initialize_gtp_player): Likewise.
	(move_has_been_played): Likewise.
	(generate_move_via_gtp, start_clock_if_needed): New functions.

	* gui-gtk/gtk-clock.c, gui-gtk/gtk-clock.h: New files.

	* gtp/gtp-client.c (COLOR_STRING): New macro.
	(gtp_client_send_time_settings, gtp_client_send_time_left): New
	functions.

2004-06-10  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-new-game-dialog.c (gtk_new_game_dialog_present): Add
	time control parameters widgets.
	(time_control_type_changed): New function.
	(begin_game): Create `TimeControl' objects when needed.

	* gui-gtk/gtk-utils.c (gtk_utils_create_time_spin_button)
	(time_spin_button_output, time_spin_button_input): New functions.

	* gui-gtk/gui-back-end.c (gui_back_end_timer_restart)
	(gui_back_end_timer_delete)
	(gui_back_end_timer_get_seconds_elapsed): New functions.

	* gui-utils/time-control.c, gui-utils/time-control.h: New files.

2004-06-06  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-utils.c (gtk_utils_create_selector)
	(gtk_utils_create_invisible_notebook): New functions.

2004-06-01  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-preferences.c (gtk_preferences_finalize): Remove.
	(gtk_preferences_init): Register `gtp_engines_list_store' with
	gui_back_end_register_object_to_finalize().

	* gui-gtk/gui-back-end.c
	(gui_back_end_register_object_to_finalize): New function.
	(run_main_loop): Dereference objects from `objects_to_finalize'
	list.

2004-05-27  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-preferences.c (chain_client_initialized): Update
	engine's information after successful initialization.  I.e. notice
	version upgrades, etc. automatically.

	* utils/string-list.c (string_list_duplicate_items): Bug-fix:
	don't leave the new list unterminated, write NULL in the last
	`next' pointer.

2004-05-21  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c (initialize_gtp_player): Don't send
	`fixed_handicap 0' GTP command (specification requires to just
	omit it).

2004-05-13  Paul Pogonyshev  <pogonyshev@gmx.net>

	* sgf/sgf.h: Remove types `SgfPoint', `SgfPositionList',
	`SgfAmazonsMoveData' and `SgfAbstractMoveData' and all `#define'd
	pseudo-functions.

	* sgf/sgf.h: Use types from board code instead of removed ones.	
	* sgf/sgf-diff-utils.c: Likewise.
	* sgf/sgf-parser.c: Likewise.
	* sgf/sgf-tree.c: Likewise.
	* sgf/sgf-utils.c: Likewise.
	* sgf/sgf-writer.c: Likewise.

	* gui-gtk/gtk-goban-window.c (playing_mode_goban_clicked):
	Bug-fix: use `GOBAN_TILE_DONT_CHANGE' instead of `TILE_NONE'.
	Caused serious problems with all games when trying to play an
	illegal move.
	(free_handicap_mode_goban_clicked): Likewise.

2004-05-12  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c: Add support for user scoring of Go
	games.  Cope with the changes in goban's feedback handling.
	(update_territory_markup, go_scoring_mode_done)
	(reenter_current_node, go_scoring_mode_pointer_moved)
	(go_scoring_mode_goban_clicked): New functions.
	(play_pass_move): Call move_has_been_played() after updating
	controls for new SGF node so that the former function can change
	goban's contents.
	(playing_mode_goban_clicked): Likewise.
	(update_children_for_new_node): Make dead stones more transparent.
	(free_handicap_has_been_placed): Use reenter_current_node().

	* gui-gtk/gtk-goban.c: Add possibility for overlays to span
	several positions by using position lists.  Make overlays
	overwrite goban markup as well as the main grid.
	(gtk_goban_set_contents): Rename from
	gtk_goban_set_grid_contents().
	(set_feedback_data): Handle more feedback types, including goban
	markup overwriting feedbacks.

	* board/go.c (go_get_string_stones)
	(go_get_logically_dead_stones, go_score_game)
	(go_mark_territory_on_grid): New functions.

2004-05-10  Paul Pogonyshev  <pogonyshev@gmx.net>

	* board/board.c (board_position_list_sort)
	(board_position_lists_overlap)
	(board_position_list_find_position)
	(board_position_list_mark_on_grid): New functions.

	* utils/utils.c (utils_compare_ints): New function.

2004-05-09  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-new-game-dialog.c (set_handicap_adjustment_limits):
	Don't use adjustment properties: they only appeared in GTK+ 2.4.

2004-05-01  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-preferences.c (create_board_appearance_page): Add
	controls for configuring Amazons' checkerboard pattern.  Change
	controls layout: consider grid and labels a part of background.
	(update_board_grid_and_labels_color): Rename from
	update_board_foreground().
	(update_checkerboard_pattern): New function.

	* gui-utils/common-configuration-values.list: Rename "Foreground"
	configuration variable to "Grid and labels color".

	* gui-gtk/gtk-utils.c (gtk_utils_pack_in_box): Add a way to
	request packing in box end.
	(gtk_utils_create_mnemonic_label): New function.

	* gui-gtk/gtk-named-vbox.c (gtk_named_vbox_size_request)
	(gtk_named_vbox_size_allocate): Use `QUARRY_SPACING_SMALL' instead
	of the box spacing as distance between the label and the contents.
	* gui-gtk/gtk-goban-window.c (gtk_goban_window_init): Use
	`QUARRY_SPACING_SMALL' instead of `QUARRY_SPACING_GOBAN_WINDOW'
	for the gap between players' control sets.

2004-04-30  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban.c (gtk_goban_expose): Don't draw clipped
	objects (significant speedup).
	(gtk_goban_expose): Draw checkerboard pattern if requested.
	(set_goban_style_appearance): Rename from
	set_goban_appearance_style().
	(set_goban_non_style_appearance): New function.  Only handles
	checkerboard pattern at present.

	* gui-utils/tile-set.c (tile_set_create_or_reuse): Initialize
	`cell_size' parameter of `TileSet' structure.

	* gui-utils/common-configuration-sections.list: Add configuration
	parameters for checkerboard pattern for Amazons board.
	* gui-utils/common-configuration-values.list: Likewise.
	* gui-utils/common-configuration-defaults.list: Likewise.

	* gui-utils/parse-configuration.c (configuration_parse_defaults2):
	Add support for structure fields in new (generated) structures.

	* gui-utils/common-configuration-values.list: Remove value
	identifiers (not used now).
	* gui-gtk/gtk-configuration.list: Likewise.

	* gui-utils/configuration.c (configuration_set_section_values):
	Remove function.
	(configuration_set_string_value)
	(configuration_set_string_list_value)
	(configuration_set_string_list_value_steal_strings): New
	functions.

	* utils/string-list.c (string_list_duplicate_items): Add `const'
	modifier to second argument.

	* gui-gtk/gtk-new-game-dialog.c (begin_game): Free `data'
	structure.

2004-04-29  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c (gtk_goban_window_finalize):
	Unreference `item_factory'.

2004-04-28  Paul Pogonyshev  <pogonyshev@gmx.net>

	* utils/utils.h (string_list_is_empty)
	(string_list_is_single_string): Don't cast to `const StringList *'
	to avoid GCC 3.3+ warnings.
	* gui-utils/configuration.c (write_section): Cast to `const
	StringList *' to cope with the above change.

	* gui-gtk/gtk-goban-window.c: Add full support for free handicap.
	(GTP_ENGINE_CAN_PLAY_MOVES): New macro.
	(gtk_goban_window_init): Create "special mode" control set.
	(gtk_goban_window_enter_game_mode): Enter free handicap special
	mode if user is to set up free handicap.
	(enter_special_mode, leave_special_mode)
	(free_handicap_mode_done)
	(set_goban_signal_handlers, free_handicap_mode_pointer_moved)
	(free_handicap_mode_goban_clicked)
	(free_handicap_has_been_placed): New functions.
	(navigate_goban): Rename from playing_mode_navigate_goban().
	Navigation should always work the same way or just be disabled.
	(initialize_gtp_player): Rewrite: make reentrant and more generic.
	(gtp_player_initialized_for_game): Remove (essentially include in
	the above function).
	(move_has_been_played): Rewrite.  Remove `color' parameter again.
	Generate moves even if opponent is not initialized.
	* gui-gtk/quarry-stock.c: New stock item `QUARRY_STOCK_DONE'.
	* gui-gtk/gtk-new-game-dialog.c (gtk_new_game_dialog_present):
	Don't desensitize free handicap controls: unneeded now.

	* gui-gtk/gtk-goban.h: New feedback types
	`GOBAN_FEEDBACK_ADD_BLACK_OR_REMOVE' and
	`GOBAN_FEEDBACK_ADD_WHITE_OR_REMOVE'.  Remove `_DEFAULT' from
	`GOBAN_FEEDBACK_MOVE' and its color variants.
	* gui-gtk/gtk-goban.c (gtk_goban_set_grid_contents)
	(gtk_goban_get_grid_contents, gtk_goban_diff_against_grid): New
	functions.
	(set_overlay_data): Allow setting overlay tile to `TILE_NONE'.
	(set_feedback_data): Handle new feedback types.  Cope with the
	above change.

	* gui-gtk/gtk-utils.h: Define gtk_entry_set_alignment() to nothing
	unless GTK+ version is 2.4 or higher.
	(G_MAXUINT8, G_MAXUINT16): Define if not yet defined by GLib
	headers.

	* gtp/gtp-client.c (gtp_client_place_free_handicap)
	(parse_free_handicap_placement, gtp_client_set_free_handicap): New
	functions.
	* board/board.c (game_format_position_list)
	(game_parse_position_list): New functions.

	* sgf/sgf-utils.c (sgf_utils_add_free_handicap_stones): New
	function.
	(determine_final_color_to_play): If there is positive handicap,
	set `sgf_color_to_play' to `WHITE' only if handicap stones are
	present in the same node.

2004-04-27  Paul Pogonyshev  <pogonyshev@gmx.net>

	* utils/memory-pool.c (memory_pool_free): Fix bug: do free the
	very last item in the pool if asked.  Fix typo: when profiling,
	increment the number of freed items, not of allocated ones.

	* sgf/sgf-diff-utils.c (generate_sgf_collection_diff)
	(generate_sgf_node_layer_diff): Initialize some variables to
	silence GCC warnings.
	* gui-utils/configuration.c (configuration_read_from_file):
	Likewise.
	* gui-gtk/gtk-utils.c (gtk_utils_create_titled_page): Likewise.

	* gui-gtk/gtk-color-button.c: Various backports to GTK+ pre-2.4
	and for compilation in Quarry source tree.  See file for details.

	* gui-gtk/quarry-marshal.list: New marshaller `VOID:VOID'.
	* gui-gtk/Makefile.am: Fix typo in `quarry-marshal.c' build rule:
	">", not ">>".

2004-04-26  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-color-button.c, gui-gtk/gtk-color-button.h: New
	files, copy from GTK+ version 2.4.0.  Rename to follow Quarry
	filename standard.  Modify to avoid compilation if GTK+ 2.4 is
	present anyway.

	* gui-gtk/gtk-preferences.c (create_board_appearance_page):
	Implement.  Add controls for all implemented board appearance
	configuration variables.
	(update_board_background, update_board_background_texture)
	(update_board_foreground): New functions.

	* gui-gtk/gtk-goban.c: Keep track of all goban widgets.
	(gtk_goban_update_appearance): New function.

	* utils/utils.h (QUARRY_COLORS_ARE_EQUAL): New macro.

	* gui-utils/common-configuration-defaults.list: Use value
	substitution for default texture file paths.
	* gui-gtk/Makefile.am: Pass `PACKAGE_TEXTURES_DIR' variable to
	`parse-configuration' utility.

	* gui-utils/parse-configuration.c (configuration_parse_defaults2):
	Read defaults of type `string' with parse_multiline_string() so
	that value substitution makes sense.

	* utils/parse-list.c: Add new `substitute_value' command support.
	Add command-line options support.
	(parse_list_main): Print help/usage messages to `stdout' or
	`stderr' according to GNU standards.
	(print_usage): New function.

	* utils/utils.h (AssociationList): New global string list type.
	* utils/string-list.c (association_list_item_dispose)
	(association_list_find_association): New functions.

	* utils/getopt.c, utils/getopt1.c, utils/getopt.h: New files, copy
	from GNU C Library version 2.3.2.

2004-04-25  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban.c: Use style modifiers instead of new style
	for changing widget appearance.
	(set_goban_appearance_style): New function.
	* gui-gtk/gtk-utils.c (gtk_utils_set_gdk_color)
	(gtk_utils_set_quarry_color): New functions.

	* gui-utils/parse-configuration.c (configuration_parse_sections2):
	Bug-fix: don't try to define new structure several times.

	* gui-utils/common-configuration-sections.list: Add configuration
	data for board appearance for Go, Amazons and Othello games.
	* gui-utils/common-configuration-values.list: Likewise.
	* gui-utils/common-configuration-defaults.list: Likewise.

	* gui-utils/configuration.c (configuration_read_from_file): Only
	consider first word of value when parsing values of non-string
	configuration variables.

	* gui-utils/parse-configuration.c: Add support for `color'
	configuration value type.
	* gui-utils/configuration.c: Likewise.

	* utils/utils.h (QuarryColor): New structure.
	* utils/parse-list.c (parse_color): New function.
	* gui-utils/configuration-internals.h: Include `utils.h' for the
	`QuarryColor' structure.

2004-04-24  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-utils/configuration.c (configuration_read_from_file): Close
	configuration file.

2004-04-23  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-configuration.list: Add configuration variables for
	game rules to "New Game Parameters" section.
	* gui-gtk/gtk-new-game-dialog.c (gtk_new_game_dialog_present): Use
	new configuration variables for initialization.
	(begin_game): Set them when beginning new game.

	* gui-utils/parse-configuration.c: Add support for configuration
	variables of type `real'.
	* gui-utils/configuration.c: Likewise.
	* gui-utils/configuration.c: Complete support for configuration
	variables of type `int' (reading from file).

	* gui-gtk/gtk-goban-window.c (initialize_gtp_player): Add support
	for fixed handicap and komi.
	* gtp/gtp-client.c (gtp_client_set_fixed_handicap)
	(gtp_client_set_komi): New functions.

	* sgf/sgf-tree.c (sgf_node_get_komi): New function.

	* gui-gtk/gtk-new-game-dialog.c: Implement game rules (partially).
	(show_game_specific_rules, set_handicap_adjustment_limits): New
	functions.
	
	* sgf/sgf-utils.c (sgf_utils_set_handicap): New function.
	* board/go.c (go_get_max_fixed_handicap)
	(go_get_fixed_handicap_stones): New functions.

	* gui-gtk/gtk-utils.c (gtk_utils_create_spin_button): New
	function.

2004-04-22  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-games.h (GTK_MIN_BOARD_SIZE, GTK_MAX_BOARD_SIZE):
	New macros.

	* quarry.h (MIN, MAX, ROUND_DOWN): New macros.  Use `#undef' to
	avoid conflicts with GLib or whatever else.

	* gui-gtk/gtk-utils.c (gtk_utils_create_titled_page): Don't use
	gtk_widget_show_all() on page contents (too intrusive).
	(gtk_utils_create_titled_page): Use gtk_utils_pack_in_box().
	* gui-gtk/gtk-assistant.c (gtk_assistant_add_page): Show added
	pages.

2004-04-21  Paul Pogonyshev  <pogonyshev@gmx.net>

	* sgf/sgf-diff-utils.c: New file with various functions for
	comparing SGF game trees and their collections.
	* sgf/sgf-diff.c: New file with standalone `sgf-diff' utility
	code (very simplistic at present).

	* sgf/sgf-writer.c (sgf_write_file): Add empty line between SGF
	game trees.

	* sgf/sgf-tree.c (sgf_node_delete): Rewrite to reduce stack usage
	when branching factor is high (follow algorithm of
	parse_node_tree() and parse_node_sequence() from `sgf-parser.c').
	(sgf_node_count_subtree_nodes): Likewise (had different problem).
	(sgf_node_count_subtree_nodes): Rename from
	sgf_node_count_sub_tree_nodes().

	* sgf/sgf-tree.c (sgf_game_tree_duplicate)
	(sgf_game_tree_duplicate_with_nodes)
	(sgf_node_duplicate, sgf_node_duplicate_recursively)
	(sgf_node_duplicate_to_given_depth, sgf_property_duplicate): New
	functions.
	(sgf_label_list_duplicate): New function.

	* board/board.h (board_position_list_duplicate): New macro.
	* sgf/sgf.h (sgf_position_list_duplicate): New macro.

2004-04-20  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c (move_has_been_played): Fix crashes
	when `color_to_play' is EMPTY (happens in Othello games) by
	getting explicit `color' argument from the caller.

2004-04-18  Paul Pogonyshev  <pogonyshev@gmx.net>

	* sgf/sgf-parser.c (parse_buffer): Fix bug that prevented correct
	parsing of files with multiple SGF game trees.

2004-04-17  Paul Pogonyshev  <pogonyshev@gmx.net>

	* board/board.c (board_position_lists_are_equal): Rename from
	board_position_list_equal().
	* sgf/sgf.h (sgf_position_lists_are_equal): Likewise.

2004-04-16  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-goban-window.c
	(USER_CAN_PLAY_MOVES): New macro.
	(gtk_goban_window_init): New sub-menu "Play" with "Pass" item.
	(play_pass_move): New function.
	(update_children_for_new_node): Sensitize/desensitize "Pass" menu
	item depending on the current game and who is to play.

2004-04-15  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-gtk/gtk-utils.c (gtk_utils_create_message_dialog): Comment
	gtk_window_set_skip_taskbar_hint() call out because it prevents
	KDE window manager from giving message dialogs focus.  Also make
	dialog modal even it has no parent (unless flags tell otherwise).

	* gui-gtk/gtk-goban-window.c (gtk_goban_window_save): Use
	gtk_utils_add_file_selection_response_handlers().
	* gui-gtk/gtk-parser-interface.c (gtk_parser_interface_present):
	Likewise.
	* gui-gtk/gtk-preferences.c (browse_for_gtp_engine): Likewise.

	* gui-gtk/gtk-utils.c
	(gtk_utils_add_file_selection_response_handlers)
	(overwrite_confirmation, file_selection_response): New functions.
	Ask user if she really wants to overwrite existing file.
	(gtk_utils_create_message_dialog): Remove `response_callback'
	argument.  Add `GTK_UTILS_DESTROY_ON_RESPONSE' flag to acomplish
	similar goal.
	* gui-gtk/quarry-stock.c: New stock item `QUARRY_STOCK_OVERWRITE'.

2004-04-14  Paul Pogonyshev  <pogonyshev@gmx.net>

	* gui-utils/tile-set.c (tile_set_dump_recycle): Bug-fix: don't
	deadlock when performing "lazy" recycling.

	* gui-gtk/gtk-utils.c (gtk_utils_set_menu_items_sensitive): New
	function.

	* gui-gtk/gtk-goban-window.c: Remove `navigate_goban' signal.
	(gtk_goban_window_init): Add "Go" (as verb) sub-menu.  Replace
	`navigate_goban' signal with generated `GtkAccelGroup' bindings.
	(update_children_for_new_node): Set items of "Go" sub-menu
	sensitive or insensitive depending on the node.

	* gui-gtk/gtk-goban.c (gtk_goban_class_init): Initialize
	`navigate' class member, even if GLib does that itself.
	* gui-gtk/gtk-preferences.c (engine_selector_destroyed): Free
	selector data, don't leak memory.

	* board/amazons.c (amazons_is_legal_move): Bug-fix: make function
	work properly when "to" point is a null point.

2004-04-13  Paul Pogonyshev  <pogonyshev@gmx.net>

	* sgf/sgf-writer.c (do_write_point_or_rectangle): Fix typo ('['
	instead of ']') that caused severe SGF file corruptions.

	* gui-gtk/gtk-goban-window.c: Add basic support for SGF file
	saving.  Note: quite dangerous now, because it never checks or
	asks anything, just writes.
	(gtk_goban_window_save)
	(save_file_as_response, save_file_as_destroy): New functions.

	* gui-gtk/gtk-goban-window.c (gtk_goban_window_init): Add menu bar
	to window (with just few items for now).

	* gui-gtk/Makefile.am: Remove custom build rules for
	`quarry-stock.o', because `QUARRY_WARNINGS_GTK' does not contain
	`-Wwrite-strings' (which is problematic for this file) anymore.


Changes before the project registration on Gna! (2004-04-12) were not logged.


  Copyright (C) 2004 Paul Pogonyshev.

  Copying and distribution of this file, with or without modification,
  are permitted provided the copyright notice and this notice are preserved.
